# 카카오 알림톡 자동 발송 설정 가이드

## 개요
무통장 입금 신청 시 자동으로 카카오 알림톡을 발송하는 기능을 설정하는 방법입니다.

## 1. 카카오 비즈니스 채널 설정

### 1.1 카카오 비즈니스 계정 생성
1. https://business.kakao.com/ 접속
2. 카카오 계정으로 로그인
3. 비즈니스 채널 생성

### 1.2 알림톡 서비스 신청
1. 비즈니스 채널에서 "알림톡" 서비스 신청
2. 발신번호 등록 (필수)
3. 템플릿 등록 및 승인

### 1.3 API 키 발급
1. 비즈니스 채널 설정 → API 관리
2. API 키 발급
3. 템플릿 ID 확인

## 2. 환경 변수 설정

`services/main-api/` 폴더에 `.env` 파일을 생성하고 다음 내용을 추가:

```env
# 카카오 알림톡 서비스 설정
SMS_ENABLED=true

# 카카오 비즈니스 설정
KAKAO_ACCESS_TOKEN=your_api_key_here
KAKAO_TEMPLATE_ID=your_template_id_here
KAKAO_SENDER_KEY=your_sender_key_here

# 관리자 전화번호
ADMIN_PHONE=010-5904-2213
```

## 3. 발송되는 알림톡 내용

### 관리자에게 발송
```
[나대리que] 무통장 입금 신청

사용자: 최호진(insavi)
입금자: 최호진
금액: 10,000원
연락처: 010-1234-5678
메모: 없음
신청시간: 2025-07-06 14:43
```

### 입금자에게 발송
```
[나대리que] 입금 신청 완료

최호진님의 입금 신청이 접수되었습니다.

입금자명: 최호진
신청금액: 10,000원
입금계좌: [계좌번호]
입금기한: 24시간 이내

입금 후 관리자 확인 시 예치금이 충전됩니다.
문의: 010-5904-2213
```

## 4. 템플릿 설정

### 4.1 관리자 알림 템플릿
카카오 비즈니스 콘솔에서 다음 변수들을 포함한 템플릿을 등록:
- `{{user_name}}`: 사용자 이름
- `{{user_id}}`: 사용자 ID
- `{{depositor_name}}`: 입금자명
- `{{amount}}`: 금액
- `{{phone_number}}`: 연락처
- `{{note}}`: 메모
- `{{request_time}}`: 신청시간

### 4.2 사용자 확인 템플릿
카카오 비즈니스 콘솔에서 다음 변수들을 포함한 템플릿을 등록:
- `{{user_name}}`: 사용자 이름
- `{{depositor_name}}`: 입금자명
- `{{amount}}`: 금액
- `{{account_number}}`: 입금계좌
- `{{deadline}}`: 입금기한
- `{{contact}}`: 문의처

## 5. 테스트 방법

### 5.1 알림톡 비활성화 상태에서 테스트
```env
SMS_ENABLED=false
```
- 알림톡은 발송되지 않지만 로그에 발송 내용이 기록됩니다.

### 5.2 알림톡 활성화 상태에서 테스트
```env
SMS_ENABLED=true
```
- 실제 카카오 알림톡이 발송됩니다.

## 6. 비용

### 카카오 알림톡
- **무료**: 카카오톡 앱을 통해 발송
- **제한**: 수신자가 카카오톡 앱을 사용해야 함
- **대안**: 수신자가 카카오톡을 사용하지 않는 경우 SMS로 대체 발송 가능

## 7. 장점

1. **무료**: SMS 대비 비용 절약
2. **템플릿**: 미리 정의된 템플릿 사용으로 일관된 메시지
3. **브랜딩**: 로고, 색상 등 브랜드 요소 적용 가능
4. **버튼**: 액션 버튼 추가 가능 (예: "입금 확인", "문의하기")

## 8. 주의사항

1. **발신번호 등록 필수**: 카카오 비즈니스에서 발신번호를 미리 등록해야 합니다.
2. **템플릿 승인**: 알림톡 템플릿은 카카오에서 승인 후 사용 가능합니다.
3. **수신 조건**: 수신자가 카카오톡 앱을 사용해야 합니다.
4. **수신 거부**: 수신자가 수신 거부할 수 있습니다.

## 9. 문제 해결

### 알림톡 발송 실패 시
1. 환경 변수 확인
2. 카카오 비즈니스 콘솔에서 발신번호 등록 확인
3. 템플릿 승인 상태 확인
4. API 키 권한 확인
5. 로그 확인: `services/main-api/logs/`

### SMS 대체 발송
수신자가 카카오톡을 사용하지 않는 경우, SMS로 대체 발송하는 기능을 추가할 수 있습니다.

### 테스트 모드
개발 중에는 `SMS_ENABLED=false`로 설정하여 실제 알림톡 발송 없이 테스트할 수 있습니다. 