<!DOCTYPE html>
<html>

<head>
    <title>ì¸ì¦ ìƒíƒœ ë””ë²„ê¹…</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        .debug-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .debug-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .debug-content {
            background: #f9f9f9;
            padding: 10px;
            border-radius: 3px;
            font-family: monospace;
        }

        button {
            padding: 8px 16px;
            margin: 5px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        button:hover {
            background: #0056b3;
        }

        .error {
            color: #dc3545;
        }

        .success {
            color: #28a745;
        }

        .warning {
            color: #ffc107;
        }
    </style>
</head>

<body>
    <h1>ğŸ” ì¸ì¦ ìƒíƒœ ë””ë²„ê¹…</h1>

    <div class="debug-section">
        <div class="debug-title">localStorage ë‚´ìš©</div>
        <div id="localStorageContent" class="debug-content"></div>
        <button onclick="refreshLocalStorage()">ìƒˆë¡œê³ ì¹¨</button>
    </div>

    <div class="debug-section">
        <div class="debug-title">sessionStorage ë‚´ìš©</div>
        <div id="sessionStorageContent" class="debug-content"></div>
        <button onclick="refreshSessionStorage()">ìƒˆë¡œê³ ì¹¨</button>
    </div>

    <div class="debug-section">
        <div class="debug-title">ì¿ í‚¤ ë‚´ìš©</div>
        <div id="cookieContent" class="debug-content"></div>
        <button onclick="refreshCookies()">ìƒˆë¡œê³ ì¹¨</button>
    </div>

    <div class="debug-section">
        <div class="debug-title">ì¸ì¦ ë°ì´í„° ë¶„ì„</div>
        <div id="authAnalysis" class="debug-content"></div>
        <button onclick="analyzeAuth()">ë¶„ì„</button>
    </div>

    <div class="debug-section">
        <div class="debug-title">ì‘ì—…</div>
        <button onclick="clearAuthData()">ì¸ì¦ ë°ì´í„° ì‚­ì œ</button>
        <button onclick="goToLogin()">ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ</button>
        <button onclick="goToHome()">í™ˆìœ¼ë¡œ</button>
        <button onclick="goToAdmin()">ê´€ë¦¬ì í˜ì´ì§€ë¡œ</button>
    </div>

    <script>
        function refreshLocalStorage() {
            const content = document.getElementById('localStorageContent');
            let html = '';

            if (localStorage.length === 0) {
                html = '<span class="warning">localStorageê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</span>';
            } else {
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    const value = localStorage.getItem(key);
                    html += `<div><strong>${key}:</strong> ${value}</div>`;
                }
            }

            content.innerHTML = html;
        }

        function refreshSessionStorage() {
            const content = document.getElementById('sessionStorageContent');
            let html = '';

            if (sessionStorage.length === 0) {
                html = '<span class="warning">sessionStorageê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</span>';
            } else {
                for (let i = 0; i < sessionStorage.length; i++) {
                    const key = sessionStorage.key(i);
                    const value = sessionStorage.getItem(key);
                    html += `<div><strong>${key}:</strong> ${value}</div>`;
                }
            }

            content.innerHTML = html;
        }

        function refreshCookies() {
            const content = document.getElementById('cookieContent');
            const cookies = document.cookie;

            if (!cookies) {
                content.innerHTML = '<span class="warning">ì¿ í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤.</span>';
            } else {
                content.innerHTML = `<div>${cookies}</div>`;
            }
        }

        function analyzeAuth() {
            const content = document.getElementById('authAnalysis');
            let html = '';

            // USER_DATA ë¶„ì„
            const userData = localStorage.getItem('USER_DATA');
            if (userData) {
                try {
                    const parsed = JSON.parse(userData);
                    html += '<h4>USER_DATA ë¶„ì„:</h4>';
                    html += `<div><strong>ID:</strong> ${parsed.id || 'N/A'}</div>`;
                    html += `<div><strong>UserID:</strong> ${parsed.userId || 'N/A'}</div>`;
                    html += `<div><strong>Name:</strong> ${parsed.name || 'N/A'}</div>`;
                    html += `<div><strong>Email:</strong> ${parsed.email || 'N/A'}</div>`;
                    html += `<div><strong>Role:</strong> <span class="${parsed.role === 'admin' ? 'success' : 'warning'}">${parsed.role || 'N/A'}</span></div>`;
                    html += `<div><strong>Balance:</strong> ${parsed.balance || 'N/A'}</div>`;
                    html += `<div><strong>Is Active:</strong> ${parsed.is_active || 'N/A'}</div>`;
                    html += `<div><strong>Token:</strong> ${parsed.token ? 'ìˆìŒ' : 'ì—†ìŒ'}</div>`;

                    // ìœ íš¨ì„± ê²€ì‚¬
                    const isValid = parsed.userId && parsed.name && parsed.role && typeof parsed.balance === 'number';
                    html += `<div><strong>ìœ íš¨ì„±:</strong> <span class="${isValid ? 'success' : 'error'}">${isValid ? 'ìœ íš¨' : 'ë¬´íš¨'}</span></div>`;
                } catch (e) {
                    html += `<div class="error">JSON íŒŒì‹± ì˜¤ë¥˜: ${e.message}</div>`;
                }
            } else {
                html += '<div class="warning">USER_DATAê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            }

            // forceLogout í”Œë˜ê·¸ í™•ì¸
            const forceLogout = sessionStorage.getItem('forceLogout');
            html += `<h4>forceLogout í”Œë˜ê·¸:</h4>`;
            html += `<div>${forceLogout ? `<span class="warning">ì„¤ì •ë¨: ${forceLogout}</span>` : '<span class="success">ì„¤ì •ë˜ì§€ ì•ŠìŒ</span>'}</div>`;

            content.innerHTML = html;
        }

        function clearAuthData() {
            if (confirm('ëª¨ë“  ì¸ì¦ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('USER_DATA');
                localStorage.removeItem('user');
                localStorage.removeItem('mockUsers');
                localStorage.removeItem('currentUser');
                localStorage.removeItem('authUser');
                localStorage.removeItem('userToken');
                localStorage.removeItem('accessToken');
                localStorage.removeItem('AUTH_TOKEN');
                localStorage.removeItem('PROGRAM_PERMISSION_CHANGING');

                sessionStorage.removeItem('userData');
                sessionStorage.removeItem('authToken');
                sessionStorage.removeItem('forceLogout');

                alert('ì¸ì¦ ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                refreshAll();
            }
        }

        function goToLogin() {
            window.location.href = 'http://localhost:3003/login';
        }

        function goToHome() {
            window.location.href = 'http://localhost:3003/';
        }

        function goToAdmin() {
            window.location.href = 'http://localhost:3003/admin';
        }

        function refreshAll() {
            refreshLocalStorage();
            refreshSessionStorage();
            refreshCookies();
            analyzeAuth();
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = function () {
            refreshAll();
        };
    </script>
</body>

</html>